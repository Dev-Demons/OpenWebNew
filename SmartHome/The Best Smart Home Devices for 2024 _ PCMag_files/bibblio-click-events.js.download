document.body.addEventListener('click',function(event){var tracker=event.target.hasAttribute('x-bibblio-track-click')?event.target:(event.target.parentElement&&event.target.parentElement.hasAttribute('x-bibblio-track-click'))?event.target.parentElement:(event.target.parentElement.parentElement&&event.target.parentElement.parentElement.hasAttribute('x-bibblio-track-click'))?event.target.parentElement.parentElement:null;if(tracker){event.preventDefault();var eventLabel=tracker.dataset.title?tracker.dataset.title:tracker.textContent?tracker.textContent.replace(/(<([^>]+)>)/ig,""):tracker.value.replace(/(<([^>]+)>)/ig,"");window.sendTracking(tracker);}});window.attachBibblioViewer=function(){window.bibblioViewed=false;var bibblio=document.querySelector('[x-bibblio-in-view]');var config={rootMargin:'0px'};window.onIntersection=function onIntersection(bibblio){if(!window.bibblioViewed&&bibblio[0].isIntersecting){window.bibblioViewed=true
window.sendTracking();}}
if(bibblio){window.bibblioObserver=new window.IntersectionObserver(window.onIntersection,config);window.bibblioObserver.observe(bibblio);}}
window.sendTracking=function(tracker=null){var itemTracker=tracker?tracker:document.querySelector('[x-bibblio-track-click]');if(itemTracker){var bibblioElements=document.querySelectorAll('[x-bibblio-context]');var contextUrls=[['sourceHref',window.location.href],['sourceCustomUniqueIdentifier',itemTracker.dataset.sourceUrl]];bibblioElements.forEach(function(item){contextUrls.push(['recommendations.customUniqueIdentifier',item.dataset.bibblioId])});var request=new XMLHttpRequest();request.open('POST',itemTracker.dataset.context);request.setRequestHeader('Content-Type','application/json');request.setRequestHeader('Authorization','Bearer '+window.bibblioRecommendationKey);request.onreadystatechange=function(){if(this.readyState===4){console.log('Status:',this.status);console.log('Headers:',this.getAllResponseHeaders());console.log('Body:',this.responseText);}};var body={'type':tracker?'Clicked':'Viewed','context':contextUrls};if(tracker){body['object']=[['customUniqueIdentifier',tracker.dataset.bibblioId]];}
request.onload=function(){if(tracker){window.location=tracker.getAttribute('href');}};request.onerror=function(){if(tracker){window.location=tracker.getAttribute('href');}};request.send(JSON.stringify(body));}}